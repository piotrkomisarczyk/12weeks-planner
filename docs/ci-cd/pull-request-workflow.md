# Pull Request Workflow

## PrzeglÄ…d

Workflow `pull-request.yml` jest automatycznie uruchamiany przy kaÅ¼dym Pull Requestcie do gaÅ‚Ä™zi `main` i wykonuje kompletnÄ… walidacjÄ™ kodu.

## Struktura Workflow

### 1. Lint (ğŸ” Lintowanie kodu)

Pierwszy krok - weryfikacja jakoÅ›ci kodu:

- Sprawdzanie skÅ‚adni i standardÃ³w kodowania
- Uruchamia siÄ™ jako pierwszy aby szybko wykryÄ‡ bÅ‚Ä™dy formatowania
- Wykorzystuje skrypt: `npm run lint`

### 2. RÃ³wnolegÅ‚e Testy (po pomyÅ›lnym lintowaniu)

#### Unit Tests (ğŸ§ª Testy jednostkowe)

- Uruchamia testy jednostkowe z pokryciem kodu (coverage)
- Wykorzystuje skrypt: `npm run test:coverage`
- Generuje raport pokrycia kodu
- Przechowuje artefakty coverage przez 7 dni

#### E2E Tests (ğŸŒ Testy end-to-end)

- Uruchamia testy E2E za pomocÄ… Playwright
- Konfiguracja:
  - **Environment**: `integration`
  - **PrzeglÄ…darka**: Chromium (zgodnie z `playwright.config.ts`)
  - **Zmienne Å›rodowiskowe** (z GitHub Secrets):
    - `SUPABASE_URL`
    - `SUPABASE_KEY`
    - `PUBLIC_SUPABASE_URL`
    - `PUBLIC_SUPABASE_ANON_KEY`
    - `OPENROUTER_API_KEY`
- Wykorzystuje skrypt: `npm run test:e2e`
- Instaluje tylko przeglÄ…darkÄ™ Chromium: `npx playwright install --with-deps chromium`
- Przechowuje Playwright report przez 7 dni

### 3. Status Comment (ğŸ’¬ Komentarz o statusie)

Finalny krok - uruchamia siÄ™ **tylko gdy wszystkie poprzednie joby zakoÅ„czÄ… siÄ™ sukcesem**:

- Pobiera raport pokrycia z testÃ³w jednostkowych
- Tworzy sformatowany komentarz w Pull Requestcie zawierajÄ…cy:
  - Status wszystkich jobÃ³w (âœ… Success)
  - Raport pokrycia kodu z testÃ³w jednostkowych:
    - Lines coverage
    - Branches coverage
    - Functions coverage
    - Statements coverage
  - Timestamp wygenerowania raportu

## Wymagane GitHub Secrets

Przed uruchomieniem workflow naleÅ¼y skonfigurowaÄ‡ nastÄ™pujÄ…ce sekrety w ustawieniach repozytorium (Settings â†’ Secrets and variables â†’ Actions â†’ Environment secrets dla environment `integration`):

```
SUPABASE_URL=your_supabase_url
SUPABASE_KEY=your_supabase_key
PUBLIC_SUPABASE_URL=your_public_supabase_url
PUBLIC_SUPABASE_ANON_KEY=your_public_anon_key
OPENROUTER_API_KEY=your_openrouter_key
```

## Wykorzystane Akcje GitHub

Wszystkie akcje uÅ¼ywajÄ… najnowszych wersji (stan na 2026-01):

- `actions/checkout@v6` - pobieranie kodu
- `actions/setup-node@v6` - konfiguracja Node.js (wersja z `.nvmrc`)
- `actions/upload-artifact@v6` - przechowywanie artefaktÃ³w
- `actions/download-artifact@v7` - pobieranie artefaktÃ³w
- `actions/github-script@v8` - tworzenie komentarzy w PR

## Uprawnienia

Workflow wymaga nastÄ™pujÄ…cych uprawnieÅ„:

- `contents: read` - odczyt zawartoÅ›ci repozytorium
- `pull-requests: write` - tworzenie komentarzy w Pull Requestach

## Diagramy PrzepÅ‚ywu

### Diagram ZaleÅ¼noÅ›ci

```
lint
  â”œâ”€> unit-test â”€â”
  â””â”€> e2e-test â”€â”€â”¤
                 â””â”€> status-comment
```

### SzczegÃ³Å‚owy PrzepÅ‚yw

1. **Trigger**: Utworzenie/aktualizacja Pull Requesta do `main`
2. **Lint**: Walidacja kodu
3. **RÃ³wnolegÅ‚e testy** (jeÅ›li lint OK):
   - Unit tests + coverage
   - E2E tests (Playwright)
4. **Status comment** (jeÅ›li wszystkie testy OK):
   - Pobranie coverage
   - Utworzenie komentarza w PR

## PrzykÅ‚adowy Komentarz PR

```markdown
## âœ… Pull Request Status

All checks have passed successfully!

### Test Results

| Job | Status |
|-----|--------|
| ğŸ” Lint | âœ… Success |
| ğŸ§ª Unit Tests | âœ… Success |
| ğŸŒ E2E Tests | âœ… Success |

### Coverage Report

**Unit Tests:**
Lines: 85.5% | Branches: 78.3% | Functions: 90.2% | Statements: 85.1%

---
*Generated by PR workflow on 2026-01-29T10:30:45.123Z*
```

## RozwiÄ…zywanie ProblemÃ³w

### Problem: Testy E2E nie dziaÅ‚ajÄ…

1. SprawdÅº czy environment `integration` jest skonfigurowany w GitHub
2. Zweryfikuj czy wszystkie wymagane sekrety sÄ… dodane
3. SprawdÅº logi Playwright w artefaktach

### Problem: Coverage nie jest generowany

1. Upewnij siÄ™, Å¼e testy jednostkowe generujÄ… coverage
2. SprawdÅº czy katalog `coverage/` jest tworzony
3. Zweryfikuj konfiguracjÄ™ Vitest w `vitest.config.ts`

### Problem: Komentarz nie pojawia siÄ™ w PR

1. SprawdÅº czy wszystkie 3 joby zakoÅ„czyÅ‚y siÄ™ sukcesem
2. Zweryfikuj uprawnienia `pull-requests: write`
3. SprawdÅº logi job'a `status-comment`

## Konserwacja

Workflow automatycznie uÅ¼ywa najnowszych wersji akcji GitHub. Regularnie sprawdzaj:

1. Czy akcje nie zostaÅ‚y zdeprecjonowane
2. Czy nie ma nowych breaking changes w akcjach
3. Czy sekrety sÄ… aktualne i waÅ¼ne
